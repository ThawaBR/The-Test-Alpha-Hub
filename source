local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local Kill = ReplicatedStorage:WaitForChild("Kill")

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "PlayerKillGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = Players.LocalPlayer:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 320)
frame.Position = UDim2.new(0.5, -100, 0.5, -160)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.Active = true
frame.Draggable = false
frame.Parent = screenGui

local minimizeBtn = Instance.new("TextButton")
minimizeBtn.Size = UDim2.new(0, 30, 0, 30)
minimizeBtn.Position = UDim2.new(1, -30, 0, 0)
minimizeBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
minimizeBtn.Text = "-"
minimizeBtn.Font = Enum.Font.SourceSansBold
minimizeBtn.TextSize = 24
minimizeBtn.TextColor3 = Color3.fromRGB(255,255,255)
minimizeBtn.Parent = frame

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -30, 0, 30)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundTransparency = 1
title.Text = "Player List"
title.Font = Enum.Font.SourceSansBold
title.TextSize = 18
title.TextColor3 = Color3.fromRGB(255,255,255)
title.Parent = frame

local scroll = Instance.new("ScrollingFrame")
scroll.Size = UDim2.new(1, 0, 1, -120)
scroll.Position = UDim2.new(0, 0, 0, 30)
scroll.BackgroundTransparency = 1
scroll.CanvasSize = UDim2.new(0,0,0,0)
scroll.ScrollBarThickness = 6
scroll.Parent = frame

local listLayout = Instance.new("UIListLayout")
listLayout.Parent = scroll
listLayout.SortOrder = Enum.SortOrder.LayoutOrder
listLayout.Padding = UDim.new(0,4)

local autoCompleteBtn = Instance.new("TextButton")
autoCompleteBtn.Size = UDim2.new(1, -10, 0, 25)
autoCompleteBtn.Position = UDim2.new(0, 5, 1, -90)
autoCompleteBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
autoCompleteBtn.Text = "Auto Complete"
autoCompleteBtn.Font = Enum.Font.SourceSans
autoCompleteBtn.TextSize = 14
autoCompleteBtn.TextColor3 = Color3.fromRGB(255,255,255)
autoCompleteBtn.Parent = frame

local espToggle = Instance.new("TextButton")
espToggle.Size = UDim2.new(1, -10, 0, 25)
espToggle.Position = UDim2.new(0, 5, 1, -60)
espToggle.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
espToggle.Text = "ESP: OFF"
espToggle.Font = Enum.Font.SourceSans
espToggle.TextSize = 14
espToggle.TextColor3 = Color3.fromRGB(255,255,255)
espToggle.Parent = frame

local creditsLabel = Instance.new("TextLabel")
creditsLabel.Size = UDim2.new(1, 0, 0, 30)
creditsLabel.Position = UDim2.new(0, 0, 1, -30)
creditsLabel.BackgroundTransparency = 1
creditsLabel.Font = Enum.Font.SourceSansBold
creditsLabel.TextSize = 12
creditsLabel.TextColor3 = Color3.fromRGB(255,255,255)
creditsLabel.Text = "Script by thawabr â€¢ youtube"
creditsLabel.Parent = frame

local function dragify(Frame)
    local dragging, dragInput, mousePos, framePos
    Frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or
           input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            mousePos = input.Position
            framePos = Frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    Frame.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or
                         input.UserInputType == Enum.UserInputType.Touch) then
            dragInput = input
        end
    end)
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if dragging and input == dragInput then
            local delta = input.Position - mousePos
            Frame.Position = UDim2.new(framePos.X.Scale, framePos.X.Offset + delta.X,
                                      framePos.Y.Scale, framePos.Y.Offset + delta.Y)
        end
    end)
end
dragify(frame)

local function createPlayerButton(player)
    if player == Players.LocalPlayer then return end
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, -6, 0, 30)
    button.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    button.Text = player.Name
    button.Font = Enum.Font.SourceSans
    button.TextSize = 14
    button.TextColor3 = Color3.fromRGB(255,255,255)
    button.Parent = scroll
    button.MouseButton1Click:Connect(function()
        local target = workspace:FindFirstChild(player.Name)
        if target then
            Kill:FireServer(target)
        end
    end)
end

local function refreshPlayerList()
    for _, obj in ipairs(scroll:GetChildren()) do
        if obj:IsA("TextButton") then obj:Destroy() end
    end
    for _, player in ipairs(Players:GetPlayers()) do
        createPlayerButton(player)
    end
    scroll.CanvasSize = UDim2.new(0,0,0, #Players:GetPlayers()*34)
end
refreshPlayerList()

Players.PlayerAdded:Connect(function()
    refreshPlayerList()
end)
Players.PlayerRemoving:Connect(function()
    refreshPlayerList()
end)

local espEnabled = false
local espBillboards = {}

local function createESP(player)
    if not espBillboards[player] then
        local billboard = Instance.new("BillboardGui")
        billboard.Name = "ESP"
        billboard.Size = UDim2.new(0, 100, 0, 40)
        billboard.StudsOffset = Vector3.new(0, 3, 0)
        billboard.AlwaysOnTop = true
        billboard.Enabled = false
        billboard.Parent = game:GetService("CoreGui")
        
        local textLabel = Instance.new("TextLabel")
        textLabel.Size = UDim2.new(1, 0, 1, 0)
        textLabel.BackgroundTransparency = 1
        textLabel.Text = player.Name
        textLabel.Font = Enum.Font.SourceSansBold
        textLabel.TextSize = 14
        textLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
        textLabel.Parent = billboard
        
        espBillboards[player] = billboard
    end
end

local function updateESP()
    for player, billboard in pairs(espBillboards) do
        if not Players:FindFirstChild(player.Name) then
            billboard:Destroy()
            espBillboards[player] = nil
        else
            local character = player.Character
            if character then
                local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
                if humanoidRootPart then
                    billboard.Adornee = humanoidRootPart
                    billboard.Enabled = espEnabled
                else
                    billboard.Enabled = false
                end
            else
                billboard.Enabled = false
            end
        end
    end
    
    if espEnabled then
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= Players.LocalPlayer then
                createESP(player)
                local character = player.Character
                if character then
                    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
                    if humanoidRootPart then
                        espBillboards[player].Adornee = humanoidRootPart
                        espBillboards[player].Enabled = true
                    end
                end
            end
        end
    end
end

local function onCharacterAdded(character, player)
    if espEnabled and espBillboards[player] then
        local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
        if humanoidRootPart then
            espBillboards[player].Adornee = humanoidRootPart
            espBillboards[player].Enabled = true
        end
    end
end

for _, player in ipairs(Players:GetPlayers()) do
    if player ~= Players.LocalPlayer then
        createESP(player)
        player.CharacterAdded:Connect(function(character)
            onCharacterAdded(character, player)
        end)
        if player.Character then
            onCharacterAdded(player.Character, player)
        end
    end
end

autoCompleteBtn.MouseButton1Click:Connect(function()
    local args = {
        [1] = 3
    }
    game:GetService("ReplicatedStorage"):WaitForChild("RemoteEvents"):WaitForChild("SendTotalNumber"):FireServer(unpack(args))
end)

espToggle.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    espToggle.Text = espEnabled and "ESP: ON" or "ESP: OFF"
    updateESP()
end)

Players.PlayerAdded:Connect(function(player)
    if player ~= Players.LocalPlayer then
        createESP(player)
        player.CharacterAdded:Connect(function(character)
            onCharacterAdded(character, player)
        end)
        if player.Character then
            onCharacterAdded(player.Character, player)
        end
        updateESP()
    end
end)

Players.PlayerRemoving:Connect(function(player)
    if espBillboards[player] then
        espBillboards[player]:Destroy()
        espBillboards[player] = nil
    end
end)

local minimized = false
minimizeBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    scroll.Visible = not minimized
    title.Visible = not minimized
    autoCompleteBtn.Visible = not minimized
    espToggle.Visible = not minimized
    creditsLabel.Visible = not minimized
    minimizeBtn.Text = minimized and "+" or "-"
    frame.Size = minimized and UDim2.new(0, 80, 0, 30) or UDim2.new(0, 200, 0, 320)
end)

frame.Modal = true
